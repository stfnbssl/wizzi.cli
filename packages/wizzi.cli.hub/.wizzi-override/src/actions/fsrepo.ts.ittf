module
    import path from 'path'
    import 
        @ fSystem 
        from 'wizzi-utils'
    import
        @ PackiFiles
        from '../features/packi/types'
    import
        @ wizziProds 
        from '../features/wizzi'
    import
        @ ittfToMeta 
        from '../utils/ittf'
    +
    export
        function getFilteredPackiFiles
            param options
                :any
            :return
                :ref Promise
                    :param 
                        :ref PackiFiles
            r_promise()
                _ fSystem.vfile().getFiles
                    @ options.sourceFolder
                    {
                        @ deep true
                        @ documentContent true
                    a_reject(files)
                        $$ loog 'getFilteredPackiFiles.files', files
                        const result
                            :ref PackiFiles
                            {
                        foreach f in files
                            if !options.filter || options.filter(f.relPath, f.content)
                                set result[f.relPath]
                                    {
                                        @ type "CODE"
                                        @ contents f.content
                        _ resolve
                            @ result

    +
    export
        function getFileContents
            param options
                :any
            :return
                :ref Promise
                    :param 
                        :string
            r_promise()
                _ fSystem.vfile().read
                    @ options.sourceFile
                    a_reject(contents)
                        $$ loog 'getFileContents.contents', contents
                        _ resolve
                            @ contents
    +
    export
        function writePackiToDest
            param packiFiles
                :ref PackiFiles
            param destFolder
                :string
            param destMetaFolder
                :string
                :optional
            foreach k in Object.keys(packiFiles)
                _ fSystem.vfile().write
                    _ path.join
                        @ destFolder
                        @ k
                    @ packiFiles[k].contents
                if destMetaFolder
                    _ fSystem.vfile().write
                        _ path.join
                            @ destMetaFolder
                            @ k
                        _ ittfToMeta
                            @ packiFiles[k].contents
                
    +
    export
        function getFileJSON
            param options
                :any
            :return
                :ref Promise
                    :param 
                        :string
            r_promise()
                if options.sourceFile.endsWith(".ittf")
                    _ wizziProds.generateArtifactFs
                        @ options.sourceFile
                        a_then_catch_throw( contents, :any, , fsrepo.getFileJSON.generateArtifactFs )
                            $$ loog 'getFileJSON.ittf.contents', contents
                            _ resolve
                                @ JSON.parse(contents.artifactContent)
                else
                    _ fSystem.vfile().read
                        @ options.sourceFile
                        a_reject(contents)
                            $$ loog 'getFileJSON.json.contents', contents
                            _ resolve
                                @ JSON.parse(contents)